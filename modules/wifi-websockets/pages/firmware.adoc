= Device firmware

The next step is to compile and flash the device's firmware.

== Clone the Git repository

Clone the git repository with the example and check out the `0.4.0` tag:

[source]
----
git clone https://github.com/drogue-iot/drogue-device
git checkout 0.4.0
----

For the next steps, you will need to change into the sub-directory `examples/stm32l4/discovery-iot01a`:

[source]
----
cd examples/stm32l4/discovery-iot01a
----

IMPORTANT: If you don't use the iot01a board, you will need to adapt the firmware to match your device and
hardware configuration!

== Update the device configuration

For the device to access your WiFi network, you must add the SSID and PSK to the following files:

`config/wifi.ssid.txt`:: The WiFi network SSID
`config/wifi.password.txt`:: The WiFi network pre-shared key

For the device to access Drogue Cloud, it also needs the device credentials you created earlier:

`config/http.username.txt`:: The device username (I.e. `device1@wifi-workshop`)
`config/http.password.txt`:: The device password (I.e. `mysecretpassword`)

== Compile and flash

You can now compile and flash the firmware. Execute the following command:

IMPORTANT: You need to have the developer board attached to your computer.

[source]
----
cargo run --release
----

== Checking the result

Once you flashed and started the program, `cargo run` will keep attached to the application running on the development
board. The output should look something like this:

[source,subs="verbatim,quotes"]
----
TODO <1>
----
<1> Successfully joined the WiFi network

Pay attention to the line indicating that the WiFi network was successfully joined.

== Pressing buttons

To send a message to Drogue Cloud, press the blue button on the board.

But before you do, open up the web console, navigate to the "Spy", and start it, using the Drogue application
name you have assigned earlier.

Now you can press the button! This will trigger the device to send a fake temperature reading to
Drogue Cloud. There is no one there to receive yet, it should still show up in the Spy console.

[source,subs="verbatim,quotes"]
----
TODO
----

On the web console, you should see the event, as received by Drogue Cloud.

image:spy-event.png[Screenshot of event spy]
